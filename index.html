<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nelson SESAMI</title>
<link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Mono:wght@400;500&family=Bricolage+Grotesque:wght@300;400;500;600;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
:root{
  --bg:#f5f3ee;--surface:#fff;--surface2:#f0ede6;--border:#e2ddd4;
  --ink:#1a1814;--ink2:#4a4540;--muted:#9a9088;
  --accent:#d4500a;--accent2:#2a5f3f;--accent3:#1a3a6b;--gold:#c4920a;
  --r-bg:#0a0c10;--r-surface:#111318;--r-surface2:#181c24;
  --r-border:rgba(255,255,255,0.07);--r-accent:#00e5a0;
  --r-text:#e8eaf0;--r-muted:#5a6070;
  --hot:#ff4757;--warm:#ffa502;--cold:#4d9fff;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--ink);font-family:'Bricolage Grotesque',sans-serif;min-height:100vh}
.shell{display:grid;grid-template-columns:220px 1fr;min-height:100vh}
.nav{background:var(--ink);display:flex;flex-direction:column;position:sticky;top:0;height:100vh;overflow-y:auto}
.nav-brand{padding:28px 24px 24px;border-bottom:1px solid rgba(255,255,255,0.08)}
.nav-brand-name{font-family:'Instrument Serif',serif;font-size:22px;color:#fff;line-height:1.2}
.nav-brand-sub{font-size:10px;color:rgba(255,255,255,0.35);font-family:'DM Mono',monospace;text-transform:uppercase;letter-spacing:1.5px;margin-top:4px}
.nav-items{padding:16px 12px;flex:1}
.nav-section{font-size:9px;font-family:'DM Mono',monospace;color:rgba(255,255,255,0.25);text-transform:uppercase;letter-spacing:1.5px;padding:0 12px;margin:16px 0 6px}
.nav-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:8px;cursor:pointer;transition:all .15s;color:rgba(255,255,255,0.5);font-size:13px;margin-bottom:2px;border:1px solid transparent;user-select:none}
.nav-item:hover{background:rgba(255,255,255,0.06);color:rgba(255,255,255,0.8)}
.nav-item.active{background:rgba(255,255,255,0.1);color:#fff;border-color:rgba(255,255,255,0.1)}
.ni-icon{width:28px;height:28px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;background:rgba(255,255,255,0.06)}
.nav-item.active .ni-icon{background:var(--accent)}
.nav-footer{padding:16px 24px;border-top:1px solid rgba(255,255,255,0.08)}
.nav-user{font-size:11px;color:rgba(255,255,255,0.3);font-family:'DM Mono',monospace}
.nav-user strong{color:rgba(255,255,255,0.6);display:block;font-size:12px;margin-bottom:2px}
.main-area{display:flex;flex-direction:column;overflow:hidden;min-height:100vh}
.topbar{background:var(--surface);border-bottom:1px solid var(--border);padding:0 36px;height:60px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:10;flex-shrink:0}
.topbar-title{font-family:'Instrument Serif',serif;font-size:20px}
.tag{font-size:10px;font-family:'DM Mono',monospace;padding:3px 9px;border-radius:20px}
.tag-orange{background:rgba(212,80,10,0.1);color:var(--accent);border:1px solid rgba(212,80,10,0.2)}
.tag-green{background:rgba(42,95,63,0.1);color:var(--accent2);border:1px solid rgba(42,95,63,0.2)}
.tag-blue{background:rgba(26,58,107,0.1);color:var(--accent3);border:1px solid rgba(26,58,107,0.2)}
.tag-purple{background:rgba(122,45,107,0.1);color:#7a2d6b;border:1px solid rgba(122,45,107,0.2)}
.tag-teal{background:rgba(0,229,160,0.1);color:#00b87a;border:1px solid rgba(0,229,160,0.2)}
/* PAGES - only active shown */
.page{display:none}
.page.active{display:flex;flex-direction:column;flex:1;animation:fadeUp .2s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.pi{padding:28px 36px;flex:1;overflow-y:auto}
/* CARDS */
.card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:24px;margin-bottom:18px}
.card-title{font-family:'Instrument Serif',serif;font-size:18px;margin-bottom:4px}
.card-desc{font-size:12px;color:var(--muted)}
.card-header{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:18px}
/* FORMS */
.fg{display:flex;flex-direction:column;gap:5px;margin-bottom:12px}
.fg2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.lbl{font-size:11px;font-family:'DM Mono',monospace;color:var(--muted);text-transform:uppercase;letter-spacing:.5px}
.inp,.sel,.ta{background:var(--bg);border:1.5px solid var(--border);border-radius:8px;padding:9px 13px;color:var(--ink);font-family:'Bricolage Grotesque',sans-serif;font-size:13px;outline:none;transition:border-color .15s;width:100%}
.inp:focus,.sel:focus,.ta:focus{border-color:var(--accent);background:var(--surface)}
.ta{resize:vertical;min-height:80px;line-height:1.6}
/* BUTTONS */
.btn{padding:10px 20px;border-radius:8px;font-family:'Bricolage Grotesque',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .15s;border:none;display:inline-flex;align-items:center;justify-content:center;gap:7px;width:100%;margin-top:10px}
.btn-d{background:var(--ink);color:#fff}.btn-d:hover{background:#2d2820;transform:translateY(-1px)}
.bcopy{background:var(--surface2);color:var(--ink2);border:1px solid var(--border);padding:6px 14px;border-radius:7px;font-size:12px;cursor:pointer;font-family:'DM Mono',monospace;transition:all .15s}
.bcopy:hover{background:var(--ink);color:#fff}
.bcopy.ok{background:var(--accent2);color:#fff;border-color:var(--accent2)}
/* CHIPS */
.chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px}
.chip{padding:5px 12px;border-radius:20px;font-size:12px;cursor:pointer;border:1.5px solid var(--border);color:var(--ink2);background:var(--surface);transition:all .15s}
.chip:hover{border-color:var(--accent);color:var(--accent)}
.chip.on{background:var(--accent);color:#fff;border-color:var(--accent)}
/* OUTPUT */
.outbox{background:var(--bg);border:1.5px solid var(--border);border-radius:10px;padding:18px;min-height:100px}
.outbox.got{border-color:var(--accent);background:var(--surface)}
.outtext{font-size:13px;line-height:1.8;color:var(--ink2);white-space:pre-wrap}
.outph{color:var(--muted);font-style:italic}
/* TEMPLATE SELECTOR */
.tgrid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}
.tcard{background:var(--surface2);border:1.5px solid var(--border);border-radius:10px;padding:14px;cursor:pointer;transition:all .15s}
.tcard:hover,.tcard.on{border-color:var(--accent);background:rgba(212,80,10,0.04)}
/* STATS */
.stats4{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:20px}
.scard{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:18px}
.sval{font-family:'Instrument Serif',serif;font-size:28px;line-height:1;margin-bottom:4px}
.slbl{font-size:11px;color:var(--muted);font-family:'DM Mono',monospace}
/* KANBAN */
.kw{padding:0 36px 36px;overflow-x:auto}
.kb{display:grid;grid-template-columns:repeat(5,minmax(190px,1fr));gap:12px}
.kcol{background:var(--surface2);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:8px}
.kch{display:flex;align-items:center;justify-content:space-between;margin-bottom:4px}
.kct{font-size:11px;font-weight:600;font-family:'DM Mono',monospace;text-transform:uppercase;letter-spacing:.5px}
.kcnt{font-size:10px;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:1px 7px;color:var(--muted);font-family:'DM Mono',monospace}
.kdrop{flex:1;min-height:40px;border-radius:7px;transition:background .15s}
.kdrop.over{background:rgba(212,80,10,0.06);outline:2px dashed rgba(212,80,10,0.3);outline-offset:-2px}
.dcard{background:var(--surface);border:1px solid var(--border);border-radius:9px;padding:12px;cursor:grab;transition:all .15s;animation:fadeUp .2s ease}
.dcard:hover{border-color:rgba(212,80,10,0.3);box-shadow:0 3px 12px rgba(0,0,0,0.08);transform:translateY(-1px)}
.dcard:active{cursor:grabbing}
.dname{font-size:13px;font-weight:600;margin-bottom:2px}
.dco{font-size:11px;color:var(--muted);font-family:'DM Mono',monospace}
.dval{font-size:12px;color:var(--accent2);font-weight:600;margin-top:6px}
.ddate{font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;margin-top:3px}
.bdel{flex-shrink:0;width:21px;height:21px;background:transparent;border:1px solid var(--border);border-radius:5px;color:var(--muted);cursor:pointer;font-size:10px;display:flex;align-items:center;justify-content:center;transition:all .15s}
.bdel:hover{background:#fee2e2;border-color:#fca5a5;color:#dc2626}
.badd{width:100%;background:transparent;border:1.5px dashed var(--border);border-radius:7px;padding:7px;color:var(--muted);font-size:12px;cursor:pointer;transition:all .15s;font-family:'Bricolage Grotesque',sans-serif;margin-top:2px}
.badd:hover{border-color:var(--accent);color:var(--accent)}
/* MODAL */
.moverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(4px);z-index:200;align-items:center;justify-content:center}
.moverlay.open{display:flex}
.mdlg{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:26px;width:430px;max-width:90vw;max-height:88vh;overflow-y:auto;animation:fadeUp .2s ease}
.mhdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
.mtitle{font-family:'Instrument Serif',serif;font-size:19px}
.mclose{background:var(--surface2);border:1px solid var(--border);color:var(--muted);width:27px;height:27px;border-radius:7px;cursor:pointer;font-size:13px;display:flex;align-items:center;justify-content:center}
/* ROI */
.divider{height:1px;background:var(--border);margin:12px 0}
/* ‚ïê‚ïê‚ïê RADAR PAGE ‚ïê‚ïê‚ïê */
#page-radar{background:var(--r-bg);color:var(--r-text)}
.rstat-bar{display:flex;gap:1px;background:rgba(255,255,255,0.05);border-bottom:1px solid rgba(255,255,255,0.07);flex-shrink:0}
.rstat{flex:1;padding:13px 18px;background:var(--r-surface);display:flex;align-items:center;gap:10px}
.rstat-icon{font-size:15px;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:7px;background:var(--r-surface2);flex-shrink:0}
.rstat-val{font-family:'Syne',sans-serif;font-size:18px;font-weight:700;line-height:1}
.rstat-lbl{font-size:10px;color:var(--r-muted);font-family:'DM Mono',monospace;text-transform:uppercase;letter-spacing:.5px;margin-top:1px}
.rbody{display:grid;grid-template-columns:250px 1fr;flex:1;overflow:hidden;min-height:calc(100vh - 130px)}
.rsidebar{background:var(--r-surface);border-right:1px solid rgba(255,255,255,0.06);padding:18px 0;overflow-y:auto}
.rsb-sec{padding:0 14px;margin-bottom:20px}
.rsb-lbl{font-family:'DM Mono',monospace;font-size:10px;color:var(--r-muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.rsearch{width:100%;background:var(--r-surface2);border:1px solid rgba(255,255,255,0.07);border-radius:7px;padding:8px 11px;color:var(--r-text);font-family:'Bricolage Grotesque',sans-serif;font-size:12px;outline:none}
.rsearch:focus{border-color:rgba(0,229,160,.3)}
.rsearch::placeholder{color:var(--r-muted)}
.rfbtn{display:flex;align-items:center;justify-content:space-between;width:100%;padding:7px 10px;background:transparent;border:1px solid transparent;border-radius:7px;color:var(--r-text);font-family:'Bricolage Grotesque',sans-serif;font-size:12px;cursor:pointer;transition:all .15s;text-align:left;margin-bottom:2px}
.rfbtn:hover{background:var(--r-surface2)}
.rfbtn.on{background:rgba(0,229,160,0.08);border-color:rgba(0,229,160,0.2);color:var(--r-accent)}
.rfcount{font-family:'DM Mono',monospace;font-size:10px;background:var(--r-surface2);padding:1px 6px;border-radius:8px;color:var(--r-muted)}
.rfbtn.on .rfcount{background:rgba(0,229,160,0.15);color:var(--r-accent)}
.rpdot{width:7px;height:7px;border-radius:50%;display:inline-block;margin-right:6px}
.rcontent{padding:22px 26px;overflow-y:auto;background:var(--r-bg)}
.rctop{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
.rctitle{font-family:'Syne',sans-serif;font-size:14px;font-weight:600}
.rsort{background:var(--r-surface2);border:1px solid rgba(255,255,255,0.07);color:var(--r-text);padding:5px 9px;border-radius:7px;font-size:11px;outline:none;cursor:pointer;font-family:'Bricolage Grotesque',sans-serif}
.rsync{font-family:'DM Mono',monospace;font-size:10px;color:var(--r-muted)}
.rsync.sy{color:var(--r-accent)}.rsync.er{color:var(--hot)}.rsync.ld{color:var(--warm)}
.rrole{font-family:'DM Mono',monospace;font-size:10px;padding:2px 9px;border-radius:20px;border:1px solid rgba(255,165,2,0.3);background:rgba(255,165,2,0.08);color:var(--warm)}
.rrole.v{border-color:rgba(77,159,255,0.3);background:rgba(77,159,255,0.08);color:var(--cold)}
.rcards{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px}
.rempty{text-align:center;padding:50px 20px;color:var(--r-muted);display:none}
.rempty.on{display:block}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.ldot{width:6px;height:6px;background:var(--r-accent);border-radius:50%;animation:blink 1.5s infinite;display:inline-block;margin-right:4px}
/* ACCOUNT CARDS */
.acard{background:var(--r-surface);border:1px solid rgba(255,255,255,0.06);border-radius:12px;padding:16px;transition:all .2s;position:relative;overflow:hidden;animation:fadeUp .3s ease both}
.acard:hover{border-color:rgba(0,229,160,0.2);transform:translateY(-2px);box-shadow:0 6px 24px rgba(0,0,0,.3)}
.acard::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;border-radius:12px 12px 0 0}
.acard.hot::before{background:var(--hot)}.acard.warm::before{background:var(--warm)}.acard.cold::before{background:var(--cold)}
.atop{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:10px}
.aavatar{width:38px;height:38px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:700;font-size:13px;flex-shrink:0}
.aname{font-family:'Syne',sans-serif;font-size:13px;font-weight:600;margin-bottom:1px}
.aseg{font-size:10px;color:var(--r-muted);font-family:'DM Mono',monospace}
.abadge{font-size:9px;font-family:'DM Mono',monospace;padding:2px 7px;border-radius:20px;text-transform:uppercase;letter-spacing:.5px;flex-shrink:0}
.bh{background:rgba(255,71,87,.12);color:var(--hot);border:1px solid rgba(255,71,87,.3)}
.bw{background:rgba(255,165,2,.12);color:var(--warm);border:1px solid rgba(255,165,2,.3)}
.bc{background:rgba(77,159,255,.12);color:var(--cold);border:1px solid rgba(77,159,255,.3)}
.asigs{display:flex;flex-direction:column;gap:5px;margin-bottom:10px}
.sig{display:flex;align-items:flex-start;gap:6px;padding:6px 8px;background:var(--r-surface2);border-radius:6px;border-left:2px solid transparent}
.sig.expansion{border-left-color:var(--r-accent)}.sig.news{border-left-color:var(--cold)}.sig.competitor{border-left-color:#ff6b35}
.sigicon{font-size:11px;flex-shrink:0;margin-top:1px}
.sigtext{font-size:11px;color:var(--r-text);line-height:1.4;flex:1}
.sigtime{font-size:10px;color:var(--r-muted);font-family:'DM Mono',monospace;flex-shrink:0}
.afoot{display:flex;align-items:center;justify-content:space-between;padding-top:9px;border-top:1px solid rgba(255,255,255,0.06)}
.acnt{font-size:11px;color:var(--r-muted);font-family:'DM Mono',monospace}
.acnt span{color:var(--r-accent)}
.aacts{display:flex;gap:4px}
.rabtn{font-size:11px;background:var(--r-surface2);border:1px solid rgba(255,255,255,0.07);color:var(--r-text);padding:4px 9px;border-radius:6px;cursor:pointer;font-family:'Bricolage Grotesque',sans-serif;transition:all .15s}
.rabtn:hover{border-color:var(--r-accent);color:var(--r-accent)}
.raibtn{font-size:11px;background:rgba(0,229,160,0.08);border:1px solid rgba(0,229,160,0.2);color:var(--r-accent);padding:4px 9px;border-radius:6px;cursor:pointer;font-family:'Bricolage Grotesque',sans-serif;transition:all .15s}
.raibtn:hover{background:rgba(0,229,160,0.15)}
.aipanel{display:none;margin-top:9px;padding:10px;background:rgba(0,229,160,0.05);border:1px solid rgba(0,229,160,0.2);border-radius:8px}
.aipanel.on{display:block;animation:fadeUp .2s ease}
.aipanel-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:7px}
.ailbl{font-family:'DM Mono',monospace;font-size:10px;color:var(--r-accent);text-transform:uppercase;letter-spacing:1px}
.aitext{font-size:11px;line-height:1.7;color:var(--r-text);white-space:pre-wrap}
/* RADAR MODALS */
.rmoverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(4px);z-index:300;align-items:center;justify-content:center}
.rmoverlay.open{display:flex}
.rmdlg{background:var(--r-surface);border:1px solid rgba(255,255,255,0.08);border-radius:14px;padding:24px;width:460px;max-width:90vw;max-height:88vh;overflow-y:auto;animation:fadeUp .2s ease}
.rmhdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
.rmtitle{font-family:'Syne',sans-serif;font-size:17px;font-weight:700;color:var(--r-text)}
.rmclose{background:var(--r-surface2);border:1px solid rgba(255,255,255,0.07);color:var(--r-muted);width:27px;height:27px;border-radius:7px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:13px}
.rlbl{display:block;font-size:11px;font-family:'DM Mono',monospace;color:var(--r-muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px}
.rinp,.rsel,.rta{width:100%;background:var(--r-surface2);border:1px solid rgba(255,255,255,0.07);border-radius:8px;padding:8px 11px;color:var(--r-text);font-family:'Bricolage Grotesque',sans-serif;font-size:13px;outline:none;transition:border-color .2s;margin-bottom:10px}
.rinp:focus,.rsel:focus{border-color:rgba(0,229,160,.35)}
.rsel option{background:var(--r-surface2)}
.rfrow{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.rsubmit{width:100%;background:var(--r-accent);color:#0a0c10;border:none;padding:10px;border-radius:8px;font-family:'Syne',sans-serif;font-size:14px;font-weight:700;cursor:pointer;margin-top:6px}
.rsubmit:hover{opacity:.85}
.rdrop{border:2px dashed rgba(77,159,255,0.3);border-radius:10px;padding:24px;text-align:center;cursor:pointer;transition:all .2s;margin-bottom:12px}
.rdrop:hover,.rdrop.over{border-color:var(--r-accent);background:rgba(0,229,160,0.04)}
.rprev{width:100%;border-collapse:collapse;font-size:11px;margin-bottom:12px;max-height:150px;overflow-y:auto;display:block}
.rprev th{background:var(--r-surface2);color:var(--r-muted);font-family:'DM Mono',monospace;text-transform:uppercase;font-size:10px;padding:5px 9px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.07);position:sticky;top:0}
.rprev td{padding:5px 9px;border-bottom:1px solid rgba(255,255,255,0.05);color:var(--r-text)}
.risum{display:flex;gap:8px;margin-bottom:12px}
.ristat{flex:1;background:var(--r-surface2);border-radius:7px;padding:8px;text-align:center}
.ristatv{font-family:'Syne',sans-serif;font-size:17px;font-weight:700;color:var(--r-accent)}
.ristatl{font-size:10px;color:var(--r-muted);font-family:'DM Mono',monospace;margin-top:1px}
/* ROLE SCREEN */
.rscreen{display:none;position:fixed;inset:0;background:rgba(10,12,16,0.96);z-index:400;align-items:center;justify-content:center;backdrop-filter:blur(8px)}
.rscreen.open{display:flex}
.rbox{background:var(--r-surface);border:1px solid rgba(255,255,255,0.08);border-radius:18px;padding:30px;width:340px;text-align:center}
.rbox-title{font-family:'Syne',sans-serif;font-size:20px;font-weight:800;color:var(--r-text);margin-bottom:4px}
.rbox-sub{color:var(--r-muted);font-size:12px;margin-bottom:22px}
.rbtns{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.rbtn{padding:16px 10px;background:var(--r-surface2);border:1px solid rgba(255,255,255,0.07);border-radius:10px;color:var(--r-text);cursor:pointer;transition:all .2s;text-align:center}
.rbtn:hover{border-color:rgba(0,229,160,0.4)}
.rbtn-icon{font-size:24px;display:block;margin-bottom:6px}
.rbtn strong{display:block;font-family:'Syne',sans-serif;font-size:13px;margin-bottom:2px}
.rbtn span{font-size:11px;color:var(--r-muted)}
/* TOAST */
.toast{position:fixed;bottom:24px;right:24px;background:var(--ink);color:#fff;padding:11px 18px;border-radius:10px;font-size:13px;z-index:999;transform:translateY(80px);transition:transform .3s ease;font-family:'Bricolage Grotesque',sans-serif}
.toast.on{transform:translateY(0)}
::-webkit-scrollbar{width:4px;height:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
</style>
</head>
<body>
<div class="shell">
  <!-- NAV -->
  <nav class="nav">
    <div class="nav-brand">
      <div class="nav-brand-name">Nelson<br>SESAMI</div>
      <div class="nav-brand-sub">by Nelson Lima</div>
    </div>
    <div class="nav-items">
      <div class="nav-section">Ferramentas</div>
      <div class="nav-item active" onclick="goTo('followup',this)">
        <div class="ni-icon">‚úâÔ∏è</div><span>Follow-up</span>
      </div>
      <div class="nav-item" onclick="goTo('prospeccao',this)">
        <div class="ni-icon">üéØ</div><span>Prospec√ß√£o</span>
      </div>
      <div class="nav-item" onclick="goTo('roi',this)">
        <div class="ni-icon">üìä</div><span>Calculadora ROI</span>
      </div>
      <div class="nav-item" onclick="goTo('pipeline',this)">
        <div class="ni-icon">üìã</div><span>Pipeline</span>
      </div>
      <div class="nav-item" onclick="goTo('radar',this)">
        <div class="ni-icon">üì°</div><span>Radar de Contas</span>
      </div>
    </div>
    <div class="nav-footer">
      <div class="nav-user"><strong>Nelson Lima</strong>Varejo Alimentar</div>
    </div>
  </nav>

  <!-- MAIN -->
  <div class="main-area">
    <div class="topbar">
      <div class="topbar-title" id="tt">E-mail de Follow-up</div>
      <span class="tag tag-orange" id="tg">Comunica√ß√£o</span>
    </div>

    <!-- FOLLOW-UP -->
    <div class="page active" id="page-followup">
      <div class="pi">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
          <div class="card">
            <div class="card-header"><div><div class="card-title">Contexto da Reuni√£o</div><div class="card-desc">Preencha para gerar o e-mail</div></div></div>
            <div class="fg2">
              <div class="fg"><label class="lbl">Empresa</label><input class="inp" id="fu-empresa" placeholder="Ex: Grupo P√£o de A√ß√∫car"></div>
              <div class="fg"><label class="lbl">Contato</label><input class="inp" id="fu-contato" placeholder="Ex: Ricardo Silva"></div>
            </div>
            <div class="fg"><label class="lbl">Cargo</label>
              <div class="chips">
                <div class="chip on" onclick="sc(this,'fu-cargo')">CEO / Dono</div>
                <div class="chip" onclick="sc(this,'fu-cargo')">Gerente de TI</div>
                <div class="chip" onclick="sc(this,'fu-cargo')">Gerente de Opera√ß√µes</div>
                <div class="chip" onclick="sc(this,'fu-cargo')">Diretor Comercial</div>
              </div><input type="hidden" id="fu-cargo" value="CEO / Dono">
            </div>
            <div class="fg"><label class="lbl">O que foi discutido?</label><textarea class="ta" id="fu-disc" placeholder="Ex: Apresentamos solu√ß√£o de gest√£o de estoque..."></textarea></div>
            <div class="fg"><label class="lbl">Principal obje√ß√£o</label>
              <div class="chips">
                <div class="chip on" onclick="sc(this,'fu-obj')">Pre√ßo alto</div>
                <div class="chip" onclick="sc(this,'fu-obj')">Prazo de implementa√ß√£o</div>
                <div class="chip" onclick="sc(this,'fu-obj')">Precisa aprovar internamente</div>
                <div class="chip" onclick="sc(this,'fu-obj')">J√° tem solu√ß√£o</div>
                <div class="chip" onclick="sc(this,'fu-obj')">Nenhuma</div>
              </div><input type="hidden" id="fu-obj" value="Pre√ßo alto">
            </div>
            <div class="fg"><label class="lbl">Pr√≥ximo passo combinado</label><input class="inp" id="fu-prox" placeholder="Ex: Enviar proposta at√© sexta-feira"></div>
            <div class="fg"><label class="lbl">Tom</label>
              <div class="chips">
                <div class="chip on" onclick="sc(this,'fu-tom')">Direto e objetivo</div>
                <div class="chip" onclick="sc(this,'fu-tom')">Consultivo</div>
                <div class="chip" onclick="sc(this,'fu-tom')">Urg√™ncia suave</div>
              </div><input type="hidden" id="fu-tom" value="Direto e objetivo">
            </div>
            <button class="btn btn-d" onclick="gerarFU()">‚úâÔ∏è Gerar E-mail</button>
          </div>
          <div class="card" style="display:flex;flex-direction:column">
            <div class="card-header"><div><div class="card-title">E-mail Gerado</div><div class="card-desc">Pronto para copiar e enviar</div></div><button class="bcopy" id="bcp-fu" onclick="cp('fu-out','bcp-fu')">Copiar</button></div>
            <div class="outbox" id="fu-box" style="flex:1"><div class="outtext outph" id="fu-out">Preencha os dados ao lado e clique em "Gerar E-mail".</div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- PROSPEC√á√ÉO -->
    <div class="page" id="page-prospeccao">
      <div class="pi">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
          <div class="card">
            <div class="card-header"><div><div class="card-title">Mensagem de Prospec√ß√£o</div><div class="card-desc">Personalizada por canal</div></div></div>
            <div class="tgrid">
              <div class="tcard on" id="tpl-email" onclick="selTpl('email')"><div style="font-size:18px;margin-bottom:6px">‚úâÔ∏è</div><div style="font-size:13px;font-weight:600;margin-bottom:2px">E-mail frio</div><div style="font-size:11px;color:var(--muted)">Primeiro contato</div></div>
              <div class="tcard" id="tpl-linkedin" onclick="selTpl('linkedin')"><div style="font-size:18px;margin-bottom:6px">üíº</div><div style="font-size:13px;font-weight:600;margin-bottom:2px">LinkedIn</div><div style="font-size:11px;color:var(--muted)">Mensagem de conex√£o</div></div>
              <div class="tcard" id="tpl-whatsapp" onclick="selTpl('whatsapp')"><div style="font-size:18px;margin-bottom:6px">üí¨</div><div style="font-size:13px;font-weight:600;margin-bottom:2px">WhatsApp</div><div style="font-size:11px;color:var(--muted)">Abordagem direta</div></div>
              <div class="tcard" id="tpl-indicacao" onclick="selTpl('indicacao')"><div style="font-size:18px;margin-bottom:6px">ü§ù</div><div style="font-size:13px;font-weight:600;margin-bottom:2px">Por indica√ß√£o</div><div style="font-size:11px;color:var(--muted)">Com nome em comum</div></div>
            </div>
            <input type="hidden" id="pr-tipo" value="email">
            <div class="fg2">
              <div class="fg"><label class="lbl">Empresa alvo</label><input class="inp" id="pr-empresa" placeholder="Ex: Rede Nordest√£o"></div>
              <div class="fg"><label class="lbl">Nome do decisor</label><input class="inp" id="pr-contato" placeholder="Ex: Ana Ferreira"></div>
            </div>
            <div class="fg"><label class="lbl">Cargo</label>
              <div class="chips">
                <div class="chip on" onclick="sc(this,'pr-cargo')">CEO / Dono</div>
                <div class="chip" onclick="sc(this,'pr-cargo')">Gerente de TI</div>
                <div class="chip" onclick="sc(this,'pr-cargo')">Gerente de Opera√ß√µes</div>
                <div class="chip" onclick="sc(this,'pr-cargo')">Diretor Comercial</div>
              </div><input type="hidden" id="pr-cargo" value="CEO / Dono">
            </div>
            <div class="fg"><label class="lbl">Gatilho</label>
              <div class="chips">
                <div class="chip on" onclick="sc(this,'pr-gatilho')">Expans√£o de lojas</div>
                <div class="chip" onclick="sc(this,'pr-gatilho')">Abertura de mercado</div>
                <div class="chip" onclick="sc(this,'pr-gatilho')">Troca de sistema</div>
                <div class="chip" onclick="sc(this,'pr-gatilho')">Sem motivo espec√≠fico</div>
              </div><input type="hidden" id="pr-gatilho" value="Expans√£o de lojas">
            </div>
            <div class="fg" id="pr-ind-grp" style="display:none"><label class="lbl">Quem indicou</label><input class="inp" id="pr-ind" placeholder="Ex: Jo√£o Mendes"></div>
            <button class="btn btn-d" onclick="gerarPR()">üéØ Gerar Mensagem</button>
          </div>
          <div class="card" style="display:flex;flex-direction:column">
            <div class="card-header"><div><div class="card-title">Mensagem Gerada</div><div class="card-desc">Edite antes de enviar</div></div><button class="bcopy" id="bcp-pr" onclick="cp('pr-out','bcp-pr')">Copiar</button></div>
            <div class="outbox" id="pr-box" style="flex:1"><div class="outtext outph" id="pr-out">Escolha o canal e preencha os dados para gerar.</div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ROI -->
    <div class="page" id="page-roi">
      <div class="pi">
        <div style="display:grid;grid-template-columns:330px 1fr;gap:20px;align-items:start">
          <div>
            <div class="card">
              <div class="card-header"><div><div class="card-title">Dados do Projeto</div><div class="card-desc">Preencha para calcular</div></div></div>
              <div style="background:var(--surface2);border:1px solid var(--border);border-radius:9px;padding:13px;margin-bottom:12px">
                <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:9px">Projeto / Solu√ß√£o</div>
                <div class="fg"><label class="lbl">Nome do projeto</label><input class="inp" id="roi-proj" placeholder="Ex: Projeto Gatecash" oninput="calcROI()"></div>
                <div class="fg2">
                  <div class="fg"><label class="lbl">CAPEX (compra)</label><input class="inp" id="roi-capex" placeholder="R$ 0,00" oninput="mR(this);calcROI()"></div>
                  <div class="fg"><label class="lbl">OPEX (loca√ß√£o/m√™s)</label><input class="inp" id="roi-opex" placeholder="R$ 0,00" oninput="mR(this);calcROI()"></div>
                </div>
              </div>
              <div style="background:var(--surface2);border:1px solid var(--border);border-radius:9px;padding:13px;margin-bottom:12px">
                <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:9px">Dados do Cliente</div>
                <div class="fg2">
                  <div class="fg"><label class="lbl">N¬∫ de PDVs</label><input class="inp" id="roi-pdvs" type="number" placeholder="Ex: 10" oninput="calcROI()"></div>
                  <div class="fg"><label class="lbl">Fat. mensal por PDV</label><input class="inp" id="roi-fat" placeholder="R$ 0,00" oninput="mR(this);calcROI()"><div style="font-size:10px;color:var(--muted);margin-top:2px">Ref: R$350k‚ÄìR$500k</div></div>
                </div>
              </div>
              <div style="background:var(--surface2);border:1px solid var(--border);border-radius:9px;padding:13px">
                <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:9px">Perdas e Meta</div>
                <div class="fg2">
                  <div class="fg"><label class="lbl">Perdas totais (%)</label><input class="inp" id="roi-ptot" type="number" placeholder="Ex: 1.82" step="0.01" oninput="calcROI()"></div>
                  <div class="fg"><label class="lbl">Perdas n√£o identificadas (%)</label><input class="inp" id="roi-pni" type="number" placeholder="Ex: 42" step="0.01" oninput="calcROI()"><div style="font-size:10px;color:var(--muted);margin-top:2px">% das perdas totais</div></div>
                </div>
                <div class="fg"><label class="lbl">Meta de redu√ß√£o (%)</label><input class="inp" id="roi-meta" type="number" placeholder="Ex: 30" step="1" oninput="calcROI()"><div style="font-size:10px;color:var(--muted);margin-top:2px">% das perdas n√£o identificadas que a solu√ß√£o reduz</div></div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header"><div class="card-title">Resultado</div></div>
            <div id="roi-res"><div style="text-align:center;padding:50px;color:var(--muted);font-style:italic;font-size:13px">Preencha os dados ao lado para calcular</div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- PIPELINE -->
    <div class="page" id="page-pipeline">
      <div class="pi" style="padding-bottom:0">
        <div class="stats4">
          <div class="scard"><div class="sval" id="pt">0</div><div class="slbl">Oportunidades</div></div>
          <div class="scard"><div class="sval" style="color:var(--accent2)" id="pv">R$ 0</div><div class="slbl">Valor total</div></div>
          <div class="scard"><div class="sval" style="color:var(--accent)" id="ph">0</div><div class="slbl">Em negocia√ß√£o</div></div>
          <div class="scard"><div class="sval" style="color:var(--gold)" id="pf">R$ 0</div><div class="slbl">Fechado</div></div>
        </div>
      </div>
      <div class="kw">
        <div class="kb">
          <div class="kcol"><div class="kch"><span class="kct" style="color:var(--muted)">Prospec√ß√£o</span><span class="kcnt" id="cnt-prospeccao">0</span></div><div class="kdrop" id="col-prospeccao" ondragover="dov(event)" ondrop="dp(event,'prospeccao')" ondragleave="dlv(event)"></div><button class="badd" onclick="openDM('prospeccao')">+ Adicionar</button></div>
          <div class="kcol"><div class="kch"><span class="kct" style="color:var(--accent3)">Qualifica√ß√£o</span><span class="kcnt" id="cnt-qualificacao">0</span></div><div class="kdrop" id="col-qualificacao" ondragover="dov(event)" ondrop="dp(event,'qualificacao')" ondragleave="dlv(event)"></div><button class="badd" onclick="openDM('qualificacao')">+ Adicionar</button></div>
          <div class="kcol"><div class="kch"><span class="kct" style="color:var(--accent)">Proposta</span><span class="kcnt" id="cnt-proposta">0</span></div><div class="kdrop" id="col-proposta" ondragover="dov(event)" ondrop="dp(event,'proposta')" ondragleave="dlv(event)"></div><button class="badd" onclick="openDM('proposta')">+ Adicionar</button></div>
          <div class="kcol"><div class="kch"><span class="kct" style="color:var(--gold)">Negocia√ß√£o</span><span class="kcnt" id="cnt-negociacao">0</span></div><div class="kdrop" id="col-negociacao" ondragover="dov(event)" ondrop="dp(event,'negociacao')" ondragleave="dlv(event)"></div><button class="badd" onclick="openDM('negociacao')">+ Adicionar</button></div>
          <div class="kcol"><div class="kch"><span class="kct" style="color:var(--accent2)">Fechado ‚úì</span><span class="kcnt" id="cnt-fechado">0</span></div><div class="kdrop" id="col-fechado" ondragover="dov(event)" ondrop="dp(event,'fechado')" ondragleave="dlv(event)"></div><button class="badd" onclick="openDM('fechado')">+ Adicionar</button></div>
        </div>
      </div>
    </div>

    <!-- RADAR -->
    <div class="page" id="page-radar">
      <div class="rstat-bar">
        <div class="rstat"><div class="rstat-icon">üè¢</div><div><div class="rstat-val" id="r-tot">0</div><div class="rstat-lbl">Contas</div></div></div>
        <div class="rstat"><div class="rstat-icon">üî•</div><div><div class="rstat-val" id="r-hot" style="color:var(--hot)">0</div><div class="rstat-lbl">Quentes</div></div></div>
        <div class="rstat"><div class="rstat-icon">üì°</div><div><div class="rstat-val" id="r-sig" style="color:var(--r-accent)">0</div><div class="rstat-lbl">Sinais</div></div></div>
        <div class="rstat"><div class="rstat-icon">‚ö°</div><div><div class="rstat-val" id="r-opp" style="color:var(--warm)">0</div><div class="rstat-lbl">Oportunidades</div></div></div>
        <div class="rstat" style="flex:2">
          <div style="width:100%">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:5px"><div class="ldot"></div><span class="rsync" id="rsync">conectando...</span></div>
            <div id="radmin-btns" style="display:flex;gap:6px">
              <button onclick="openRM()" style="background:var(--r-accent);color:#0a0c10;border:none;padding:4px 11px;border-radius:6px;font-size:11px;cursor:pointer;font-family:'Bricolage Grotesque',sans-serif;font-weight:600">+ Nova Conta</button>
              <button onclick="openRI()" style="background:transparent;color:var(--cold);border:1px solid rgba(77,159,255,0.3);padding:4px 11px;border-radius:6px;font-size:11px;cursor:pointer;font-family:'Bricolage Grotesque',sans-serif">üì• Importar</button>
              <button onclick="rExcel()" style="background:transparent;color:var(--r-muted);border:1px solid rgba(255,255,255,0.07);padding:4px 11px;border-radius:6px;font-size:11px;cursor:pointer;font-family:'Bricolage Grotesque',sans-serif">üìä Excel</button>
            </div>
          </div>
        </div>
      </div>
      <div class="rbody">
        <aside class="rsidebar">
          <div class="rsb-sec"><div class="rsb-lbl">Buscar</div><input class="rsearch" type="text" placeholder="Buscar empresa..." id="rsearch" oninput="rFilt()"></div>
          <div class="rsb-sec">
            <div class="rsb-lbl">Prioridade</div>
            <button class="rfbtn on" onclick="rSF('all',this)">Todas <span class="rfcount" id="r-call">0</span></button>
            <button class="rfbtn" onclick="rSF('hot',this)"><span><span class="rpdot" style="background:var(--hot)"></span>Quente</span><span class="rfcount" id="r-chot">0</span></button>
            <button class="rfbtn" onclick="rSF('warm',this)"><span><span class="rpdot" style="background:var(--warm)"></span>Morno</span><span class="rfcount" id="r-cwarm">0</span></button>
            <button class="rfbtn" onclick="rSF('cold',this)"><span><span class="rpdot" style="background:var(--cold)"></span>Frio</span><span class="rfcount" id="r-ccold">0</span></button>
          </div>
          <div class="rsb-sec">
            <div class="rsb-lbl">Sinais</div>
            <button class="rfbtn" onclick="rSSig('expansion',this)">üèóÔ∏è Expans√£o de lojas</button>
            <button class="rfbtn" onclick="rSSig('news',this)">üì∞ Not√≠cias e m√≠dia</button>
            <button class="rfbtn" onclick="rSSig('competitor',this)">‚öîÔ∏è Concorrentes</button>
          </div>
          <div class="rsb-sec">
            <div class="rsb-lbl">Segmento</div>
            <button class="rfbtn" onclick="rSSeg('all',this)">Todos</button>
            <button class="rfbtn" onclick="rSSeg('Supermercados',this)">Supermercados</button>
            <button class="rfbtn" onclick="rSSeg('Farm√°cias',this)">Farm√°cias</button>
            <button class="rfbtn" onclick="rSSeg('Moda',this)">Moda</button>
            <button class="rfbtn" onclick="rSSeg('Eletr√¥nicos',this)">Eletr√¥nicos</button>
            <button class="rfbtn" onclick="rSSeg('Home Center',this)">Home Center</button>
          </div>
          <div class="rsb-sec">
            <div class="rsb-lbl">Conta</div>
            <button class="rfbtn" onclick="rSwitch()" style="color:var(--r-muted)">üîÑ Trocar perfil</button>
          </div>
        </aside>
        <main class="rcontent">
          <div class="rctop">
            <div style="display:flex;align-items:center;gap:10px">
              <div class="rctitle" id="r-sec-title">Todas as Contas</div>
              <span class="rrole" id="r-role-badge">üëë Admin</span>
            </div>
            <select class="rsort" onchange="rSortC(this.value)">
              <option value="priority">Prioridade</option>
              <option value="name">Nome A-Z</option>
              <option value="signals">Mais sinais</option>
            </select>
          </div>
          <div class="rcards" id="rcards"></div>
          <div class="rempty" id="rempty"><div style="font-size:34px;margin-bottom:8px">üì°</div><p>Nenhuma conta ainda.</p></div>
        </main>
      </div>
    </div>

  </div><!-- /main-area -->
</div><!-- /shell -->

<!-- ROLE PICKER -->
<div class="rscreen" id="rscreen">
  <div class="rbox">
    <div style="font-size:30px;margin-bottom:12px">üì°</div>
    <div class="rbox-title">Radar de Contas</div>
    <div class="rbox-sub">Como voc√™ vai usar?</div>
    <div class="rbtns">
      <button class="rbtn" onclick="rEnter('admin')"><span class="rbtn-icon">üëë</span><strong>Admin</strong><span>Gerencio e edito</span></button>
      <button class="rbtn" onclick="rEnter('viewer')"><span class="rbtn-icon">üëÅÔ∏è</span><strong>Visualizador</strong><span>S√≥ visualizo</span></button>
    </div>
  </div>
</div>

<!-- MODAL NOVA CONTA RADAR -->
<div class="rmoverlay" id="rm-modal" onclick="if(event.target===this)closeRM()">
  <div class="rmdlg">
    <div class="rmhdr"><div class="rmtitle" id="rm-title">Nova Conta</div><button class="rmclose" onclick="closeRM()">‚úï</button></div>
    <label class="rlbl">Nome da empresa *</label>
    <div style="display:flex;gap:8px;margin-bottom:10px">
      <input class="rinp" id="rf-name" placeholder="Ex: Grupo P√£o de A√ß√∫car" style="margin:0;flex:1">
      <button onclick="rAutofill()" style="background:rgba(0,229,160,0.1);border:1px solid rgba(0,229,160,0.3);color:var(--r-accent);padding:0 12px;border-radius:8px;cursor:pointer;font-size:13px;white-space:nowrap;flex-shrink:0">‚ú® IA</button>
    </div>
    <div class="rfrow">
      <div><label class="rlbl">Segmento</label><select class="rsel" id="rf-seg"><option value="">Selecione...</option><option>Supermercados</option><option>Farm√°cias</option><option>Moda</option><option>Eletr√¥nicos</option><option>Home Center</option><option>Outros</option></select></div>
      <div><label class="rlbl">Prioridade</label><select class="rsel" id="rf-pri"><option value="cold">üîµ Frio</option><option value="warm">üü° Morno</option><option value="hot">üî¥ Quente</option></select></div>
    </div>
    <label class="rlbl">N¬∫ de lojas</label><input class="rinp" id="rf-stores" type="number" placeholder="Ex: 45">
    <label class="rlbl">Sinal inicial</label><input class="rinp" id="rf-sigtxt" placeholder="Ex: Inaugurou 3 lojas em SP">
    <label class="rlbl">Tipo do sinal</label><select class="rsel" id="rf-sigtyp"><option value="expansion">üèóÔ∏è Expans√£o</option><option value="news">üì∞ Not√≠cia</option><option value="competitor">‚öîÔ∏è Concorrente</option></select>
    <button class="rsubmit" onclick="rAddAcc()">Adicionar ao Radar</button>
  </div>
</div>

<!-- MODAL IMPORTAR -->
<div class="rmoverlay" id="ri-modal" onclick="if(event.target===this)closeRI()">
  <div class="rmdlg" style="width:500px">
    <div class="rmhdr"><div class="rmtitle">üì• Importar Contas</div><button class="rmclose" onclick="closeRI()">‚úï</button></div>
    <div id="ri-s1">
      <div style="background:var(--r-surface2);border:1px solid rgba(255,255,255,0.07);border-radius:9px;padding:12px;margin-bottom:10px">
        <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--r-muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:7px">Colunas esperadas</div>
        <div style="display:flex;gap:5px;flex-wrap:wrap">
          <span style="background:rgba(0,229,160,0.08);border:1px solid rgba(0,229,160,0.2);color:var(--r-accent);font-family:'DM Mono',monospace;font-size:10px;padding:2px 7px;border-radius:5px">Nome</span>
          <span style="background:rgba(0,229,160,0.08);border:1px solid rgba(0,229,160,0.2);color:var(--r-accent);font-family:'DM Mono',monospace;font-size:10px;padding:2px 7px;border-radius:5px">Segmento</span>
          <span style="background:rgba(0,229,160,0.08);border:1px solid rgba(0,229,160,0.2);color:var(--r-accent);font-family:'DM Mono',monospace;font-size:10px;padding:2px 7px;border-radius:5px">Prioridade</span>
          <span style="background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.07);color:var(--r-muted);font-family:'DM Mono',monospace;font-size:10px;padding:2px 7px;border-radius:5px">Lojas</span>
          <span style="background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.07);color:var(--r-muted);font-family:'DM Mono',monospace;font-size:10px;padding:2px 7px;border-radius:5px">Sinal</span>
          <span style="background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.07);color:var(--r-muted);font-family:'DM Mono',monospace;font-size:10px;padding:2px 7px;border-radius:5px">Tipo Sinal</span>
        </div>
      </div>
      <button onclick="rDlTpl()" style="width:100%;background:transparent;color:var(--cold);border:1px dashed rgba(77,159,255,0.3);padding:8px;border-radius:7px;font-size:12px;cursor:pointer;margin-bottom:10px;font-family:'Bricolage Grotesque',sans-serif">‚¨áÔ∏è Baixar planilha modelo</button>
      <div class="rdrop" id="rdrop" onclick="document.getElementById('rfile').click()" ondragover="rDov(event)" ondragleave="rDlv(event)" ondrop="rDdrop(event)">
        <div style="font-size:26px;margin-bottom:7px">üìÇ</div>
        <div style="font-size:12px;color:var(--r-muted)"><strong style="color:var(--cold)">Clique</strong> ou arraste aqui ‚Äî .xlsx, .xls ou .csv</div>
      </div>
      <input type="file" id="rfile" accept=".xlsx,.xls,.csv" style="display:none" onchange="rHF(event)">
    </div>
    <div id="ri-s2" style="display:none">
      <div class="risum" id="risum"></div>
      <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--r-muted);text-transform:uppercase;margin-bottom:7px">Pr√©-visualiza√ß√£o</div>
      <table class="rprev" id="rprev"></table>
      <button class="rsubmit" onclick="rConfirmI()">‚úÖ Confirmar Importa√ß√£o</button>
      <button onclick="rResetI()" style="width:100%;background:transparent;border:1px solid rgba(255,255,255,0.07);color:var(--r-muted);padding:8px;border-radius:7px;font-size:12px;cursor:pointer;margin-top:7px;font-family:'Bricolage Grotesque',sans-serif">‚Üê Voltar</button>
    </div>
  </div>
</div>

<!-- DEAL MODAL -->
<div class="moverlay" id="dm" onclick="if(event.target===this)closeDM()">
  <div class="mdlg">
    <div class="mhdr"><div class="mtitle">Nova Oportunidade</div><button class="mclose" onclick="closeDM()">‚úï</button></div>
    <div class="fg2">
      <div class="fg"><label class="lbl">Empresa</label><input class="inp" id="d-emp" placeholder="Ex: Supermercado X"></div>
      <div class="fg"><label class="lbl">Contato</label><input class="inp" id="d-cont" placeholder="Ex: Jo√£o Silva"></div>
    </div>
    <div class="fg2">
      <div class="fg"><label class="lbl">Valor estimado (R$)</label><input class="inp" id="d-val" type="number" placeholder="Ex: 50000"></div>
      <div class="fg"><label class="lbl">Previs√£o de fechamento</label><input class="inp" id="d-data" type="date"></div>
    </div>
    <div class="fg"><label class="lbl">Observa√ß√µes</label><textarea class="ta" id="d-obs" style="min-height:60px" placeholder="Notas..."></textarea></div>
    <button class="btn btn-d" onclick="saveDeal()">Adicionar ao Pipeline</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ
const PCFG={
  followup:  {t:'E-mail de Follow-up',    c:'tag-orange',lbl:'Comunica√ß√£o'},
  prospeccao:{t:'Gerador de Prospec√ß√£o',  c:'tag-blue',  lbl:'Prospec√ß√£o'},
  roi:       {t:'Calculadora de ROI',     c:'tag-green', lbl:'Proposta de Valor'},
  pipeline:  {t:'Pipeline de Vendas',     c:'tag-purple',lbl:'Gest√£o'},
  radar:     {t:'Radar de Contas',        c:'tag-teal',  lbl:'Intelig√™ncia'}
};
function goTo(page,el){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('page-'+page).classList.add('active');
  if(el)el.classList.add('active');
  const c=PCFG[page];
  document.getElementById('tt').textContent=c.t;
  const tg=document.getElementById('tg');
  tg.className='tag '+c.c;
  tg.textContent=c.lbl;
  if(page==='radar')initRadar();
}

// ‚îÄ‚îÄ CHIPS ‚îÄ‚îÄ
function sc(el,id){
  el.closest('.chips').querySelectorAll('.chip').forEach(c=>c.classList.remove('on'));
  el.classList.add('on');
  document.getElementById(id).value=el.textContent.trim();
}

// ‚îÄ‚îÄ TEMPLATES ‚îÄ‚îÄ
function selTpl(t){
  document.querySelectorAll('.tcard').forEach(c=>c.classList.remove('on'));
  document.getElementById('tpl-'+t).classList.add('on');
  document.getElementById('pr-tipo').value=t;
  document.getElementById('pr-ind-grp').style.display=t==='indicacao'?'flex':'none';
}

// ‚îÄ‚îÄ FOLLOW-UP ‚îÄ‚îÄ
function gerarFU(){
  const emp=document.getElementById('fu-empresa').value.trim()||'a empresa';
  const con=document.getElementById('fu-contato').value.trim()||'prezado(a)';
  const disc=document.getElementById('fu-disc').value.trim();
  const obj=document.getElementById('fu-obj').value;
  const prox=document.getElementById('fu-prox').value.trim();
  const tom=document.getElementById('fu-tom').value;
  const nome=con.split(' ')[0];
  const omap={
    'Pre√ßo alto':`Entendo que o investimento √© um ponto importante. Quero apresentar nossa calculadora de ROI ‚Äî clientes similares recuperaram o investimento em menos de 6 meses.`,
    'Prazo de implementa√ß√£o':`Nossa implementa√ß√£o √© modular ‚Äî as primeiras unidades entram em opera√ß√£o em at√© 30 dias, sem impactar o dia a dia.`,
    'Precisa aprovar internamente':`Fico √† disposi√ß√£o para preparar qualquer material que facilite a apresenta√ß√£o internamente ‚Äî resumo executivo, case de sucesso ou uma demo para sua equipe.`,
    'J√° tem solu√ß√£o':`Faz sentido. O que tenho visto √© que nossa solu√ß√£o complementa o que j√° existe, reduzindo processos manuais que as outras ferramentas n√£o cobrem. Vale uma conversa r√°pida?`,
    'Nenhuma':`Com base no que conversamos, acredito que podemos gerar valor imediato para a ${emp}.`
  };
  const corpo=`Assunto: ${tom==='Urg√™ncia suave'?`Re: Nossa conversa ‚Äî pr√≥ximos passos ¬∑ ${emp}`:`Follow-up: ${emp}`}\n\n${nome},\n\nObrigado pelo tempo dedicado${disc?' e pela conversa sobre '+disc.substring(0,60)+(disc.length>60?'...':''):''}.\n\n${omap[obj]||''}\n\n${prox?`Conforme combinamos: ${prox}.`:'Quando seria um bom momento para darmos sequ√™ncia?'}\n${tom==='Urg√™ncia suave'?'\nEstou com agenda aberta at√© sexta-feira ‚Äî consigo encaixar 20 minutos no hor√°rio que for melhor para voc√™.':''}\n\nAbra√ßo,\nNelson Lima\n[Cargo] | [Empresa]\n[Telefone]`;
  setOut('fu-box','fu-out',corpo);
  toast('‚úâÔ∏è E-mail gerado!');
}

// ‚îÄ‚îÄ PROSPEC√á√ÉO ‚îÄ‚îÄ
function gerarPR(){
  const emp=document.getElementById('pr-empresa').value.trim()||'sua empresa';
  const con=document.getElementById('pr-contato').value.trim();
  const cargo=document.getElementById('pr-cargo').value;
  const gat=document.getElementById('pr-gatilho').value;
  const tipo=document.getElementById('pr-tipo').value;
  const ind=document.getElementById('pr-ind').value.trim();
  const nome=con?con.split(' ')[0]:'Ol√°';
  const gmap={
    'Expans√£o de lojas':`Vi que a ${emp} est√° em expans√£o ‚Äî parab√©ns pelo crescimento!`,
    'Abertura de mercado':`Acompanhei a entrada da ${emp} em novos mercados.`,
    'Troca de sistema':`Soube que a ${emp} est√° avaliando novas solu√ß√µes de tecnologia.`,
    'Sem motivo espec√≠fico':`Trabalho com tecnologia para varejo alimentar e a ${emp} √© exatamente o perfil que gera resultado com nossa solu√ß√£o.`
  };
  const g=gmap[gat]||gmap['Sem motivo espec√≠fico'];
  const ben=cargo.includes('TI')?'reduzir complexidade de sistemas':cargo.includes('Opera√ß√µes')?'reduzir perdas e aumentar efici√™ncia':'crescer com mais controle e previsibilidade';
  let msg='';
  if(tipo==='email')msg=`Assunto: Tecnologia para varejo ‚Äî ${emp}\n\n${nome},\n\n${g}\n\nTrabalhamos com solu√ß√µes para varejo alimentar e ajudamos redes como a ${emp} a ${ben}.\n\nTeria 20 minutos esta semana para uma conversa r√°pida?\n\nAbra√ßo,\nNelson Lima\n[Telefone]`;
  else if(tipo==='linkedin')msg=`${nome}, tudo bem?\n\n${g}\n\nTrabalhamos com tecnologia para varejo alimentar e ajudo ${cargo}s a ${ben}.\n\nPodemos conversar 15 minutos?`;
  else if(tipo==='whatsapp')msg=`Oi ${nome}! Tudo bem?\n\nSou o Nelson, trabalho com tecnologia para supermercados.\n\n${g}\n\nTeria um momento essa semana para bater um papo? ü§ù`;
  else if(tipo==='indicacao')msg=`${nome},\n\n${ind?`O ${ind} me indicou seu contato.`:'Recebi uma indica√ß√£o para falar com voc√™.'}\n\n${g}\n\nTrabalhamos com tecnologia para varejo alimentar e acredito que posso agregar muito √† ${emp}.\n\nTeria 20 minutos esta semana?\n\nAbra√ßo,\nNelson Lima`;
  setOut('pr-box','pr-out',msg);
  toast('üéØ Mensagem gerada!');
}

// ‚îÄ‚îÄ ROI ‚îÄ‚îÄ
function mR(el){
  let v=el.value.replace(/\D/g,'');
  if(!v){el.value='';return;}
  v=(parseInt(v)/100).toFixed(2);
  el.value='R$ '+parseFloat(v).toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2});
}
function pR(id){const el=document.getElementById(id);if(!el)return 0;return parseFloat((el.value||'').replace(/[R$\s.]/g,'').replace(',','.'))||0;}
function fBR(v){return'R$ '+Math.abs(v).toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2});}

function calcROI(){
  const proj=document.getElementById('roi-proj').value.trim()||'Projeto';
  const capex=pR('roi-capex'),opex=pR('roi-opex');
  const pdvs=parseFloat(document.getElementById('roi-pdvs').value)||0;
  const fat=pR('roi-fat');
  const ptot=parseFloat(document.getElementById('roi-ptot').value)||0;
  const pni=parseFloat(document.getElementById('roi-pni').value)||0;
  const meta=parseFloat(document.getElementById('roi-meta').value)||0;
  if(!pdvs||!fat||!ptot||!pni||!meta||(!capex&&!opex))return;
  const fatT=fat*pdvs,pT=fatT*(ptot/100),pNI=pT*(pni/100),eco=pNI*(meta/100);
  const pb=capex>0?Math.ceil(capex/eco):null;
  const saldo=opex>0?eco-opex:null;
  const hs='background:var(--ink);color:#fff;padding:7px 13px;font-family:"DM Mono",monospace;font-size:11px';
  const bs='background:var(--surface2);border:1px solid var(--border);border-radius:9px;overflow:hidden';
  const ts='width:100%;border-collapse:collapse;font-size:13px';
  const tr=(l,v,s='')=>`<tr><td style="padding:7px 12px;border-bottom:1px solid var(--border);color:var(--ink2)">${l}</td><td style="padding:7px 12px;border-bottom:1px solid var(--border);text-align:right;font-weight:600${s?';'+s:''}">${v}</td></tr>`;
  const tr3=(l,p,v)=>`<tr><td style="padding:7px 12px;border-bottom:1px solid var(--border);color:var(--ink2)">${l}</td><td style="padding:7px 12px;border-bottom:1px solid var(--border);text-align:center;color:var(--muted)">${p.toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2})}%</td><td style="padding:7px 12px;border-bottom:1px solid var(--border);text-align:right;font-weight:600">${fBR(v)}</td></tr>`;
  document.getElementById('roi-res').innerHTML=`
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:13px;margin-bottom:14px">
    <div style="${bs}"><div style="${hs}">${proj}</div><table style="${ts}">${capex>0?tr('CAPEX',fBR(capex)):''}${opex>0?tr('OPEX',fBR(opex)+'/m√™s'):''}${tr('Fat. total/m√™s',fBR(fatT))}</table></div>
    <div style="${bs}"><div style="${hs}">Cliente ‚Äî ${pdvs} PDV${pdvs>1?'s':''}</div><table style="${ts}">${tr('Fat. por PDV',fBR(fat),'color:var(--muted)')}${tr('Fat. total/m√™s',fBR(fatT))}</table></div>
  </div>
  <div style="${bs};margin-bottom:13px"><div style="${hs}">An√°lise de Perdas</div>
    <table style="${ts}"><thead><tr>
      <th style="padding:7px 12px;border-bottom:1px solid var(--border);text-align:left;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);font-weight:500;text-transform:uppercase">Item</th>
      <th style="padding:7px 12px;border-bottom:1px solid var(--border);text-align:center;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);font-weight:500;text-transform:uppercase">%</th>
      <th style="padding:7px 12px;border-bottom:1px solid var(--border);text-align:right;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);font-weight:500;text-transform:uppercase">R$</th>
    </tr></thead><tbody>
      ${tr3('Perdas totais',ptot,pT)}${tr3('Perdas n√£o identificadas',pni,pNI)}
      <tr style="background:rgba(42,95,63,0.08)">
        <td style="padding:8px 12px;color:var(--accent2);font-weight:600">Meta de redu√ß√£o</td>
        <td style="padding:8px 12px;text-align:center;color:var(--accent2);font-weight:600">${meta.toFixed(2)}%</td>
        <td style="padding:8px 12px;text-align:right;color:var(--accent2);font-weight:700;font-size:15px">${fBR(eco)}</td>
      </tr>
    </tbody></table>
  </div>
  <div style="${bs}"><div style="${hs}">Resultado</div><table style="${ts}">
    ${pb!==null?`<tr><td style="padding:10px 14px;border-bottom:1px solid var(--border);font-weight:600">ROI ‚Äî CAPEX</td><td style="padding:10px 14px;border-bottom:1px solid var(--border);text-align:center;font-family:'DM Mono',monospace;font-size:18px;font-weight:700;color:var(--accent)">${pb}</td><td style="padding:10px 14px;border-bottom:1px solid var(--border);color:var(--muted);font-size:12px">meses para payback</td></tr>`:''}
    ${saldo!==null?`<tr style="background:${saldo>=0?'rgba(42,95,63,0.08)':'rgba(212,80,10,0.06)'}"><td style="padding:10px 14px;font-weight:600">Saldo ‚Äî OPEX</td><td style="padding:10px 14px;text-align:center;font-family:'DM Mono',monospace;font-size:16px;font-weight:700;color:${saldo>=0?'var(--accent2)':'var(--accent)'}">${fBR(saldo)}</td><td style="padding:10px 14px;font-weight:600;color:${saldo>=0?'var(--accent2)':'var(--accent)'}">${saldo>=0?'positivo ‚úì':'negativo ‚úó'}</td></tr>`:''}
  </table></div>`;
}

// ‚îÄ‚îÄ PIPELINE ‚îÄ‚îÄ
let deals=JSON.parse(localStorage.getItem('sesami-deals')||'[]'),dmCol='prospeccao',dragId=null;
function renderP(){
  ['prospeccao','qualificacao','proposta','negociacao','fechado'].forEach(col=>{
    const el=document.getElementById('col-'+col);
    const cd=deals.filter(d=>d.col===col);
    document.getElementById('cnt-'+col).textContent=cd.length;
    el.innerHTML=cd.map(d=>`
      <div class="dcard" draggable="true" id="dc-${d.id}" ondragstart="ds(event,'${d.id}')" ondragend="de(event)">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:5px">
          <div style="flex:1;min-width:0"><div class="dname">${d.emp}</div><div class="dco">${d.cont}</div></div>
          <button class="bdel" onclick="delDeal('${d.id}')" draggable="false" title="Excluir">‚úï</button>
        </div>
        ${d.val?`<div class="dval">${new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL',maximumFractionDigits:0}).format(d.val)}</div>`:''}
        ${d.data?`<div class="ddate">üìÖ ${new Date(d.data+'T12:00:00').toLocaleDateString('pt-BR')}</div>`:''}
        ${d.obs?`<div style="font-size:10px;color:var(--muted);margin-top:4px">${d.obs.substring(0,45)}${d.obs.length>45?'...':''}</div>`:''}
      </div>`).join('');
  });
  const tot=deals.length,vt=deals.reduce((s,d)=>s+(d.val||0),0);
  document.getElementById('pt').textContent=tot;
  document.getElementById('pv').textContent=new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL',maximumFractionDigits:0}).format(vt);
  document.getElementById('ph').textContent=deals.filter(d=>d.col==='negociacao').length;
  document.getElementById('pf').textContent=new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL',maximumFractionDigits:0}).format(deals.filter(d=>d.col==='fechado').reduce((s,d)=>s+(d.val||0),0));
}
function ds(e,id){dragId=id;e.dataTransfer.effectAllowed='move';setTimeout(()=>{const el=document.getElementById('dc-'+id);if(el)el.style.opacity='0.4';},0);}
function de(){if(dragId){const el=document.getElementById('dc-'+dragId);if(el)el.style.opacity='1';}}
function dov(e){e.preventDefault();e.currentTarget.classList.add('over');}
function dlv(e){e.currentTarget.classList.remove('over');}
function dp(e,col){e.preventDefault();e.currentTarget.classList.remove('over');if(!dragId)return;const d=deals.find(x=>x.id===dragId);if(d){d.col=col;save();renderP();}dragId=null;}
function openDM(col){dmCol=col;['d-emp','d-cont','d-obs'].forEach(id=>document.getElementById(id).value='');['d-val','d-data'].forEach(id=>document.getElementById(id).value='');document.getElementById('dm').classList.add('open');}
function closeDM(){document.getElementById('dm').classList.remove('open');}
function saveDeal(){
  const emp=document.getElementById('d-emp').value.trim();
  if(!emp){toast('‚ö†Ô∏è Informe a empresa');return;}
  deals.push({id:Date.now().toString(),emp,cont:document.getElementById('d-cont').value.trim(),val:parseFloat(document.getElementById('d-val').value)||0,data:document.getElementById('d-data').value,obs:document.getElementById('d-obs').value.trim(),col:dmCol});
  save();closeDM();renderP();toast('‚úÖ Oportunidade adicionada!');
}
function delDeal(id){
  if(!confirm('Excluir esta oportunidade?'))return;
  deals=deals.filter(d=>d.id!==id);save();renderP();toast('üóëÔ∏è Exclu√≠da!');
}
function save(){localStorage.setItem('sesami-deals',JSON.stringify(deals));}

// ‚îÄ‚îÄ RADAR ‚îÄ‚îÄ
const SBU='https://hvncjjuwzlgldxbfauxv.supabase.co',SBK='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh2bmNqanV3emxnbGR4YmZhdXh2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2MzA5NTEsImV4cCI6MjA4NzIwNjk1MX0.5FzYbLZnthTnBUakOVuH_zWoC26iDOtFRCq0bNT4VPc',TBL='contas';
const COLS=[['#00e5a0','#0a2a1e'],['#4d9fff','#0a1a2e'],['#ff6b35','#2e1a0a'],['#a855f7','#1e0a2e'],['#f59e0b','#2e1e0a'],['#ec4899','#2e0a1e'],['#10b981','#0a2e1e'],['#6366f1','#0a0e2e']];
let raccs=[],rrole='',rfilt='all',rsigf=null,rsegf='all',rsort='priority',rsearch='';

function sbH(x={}){return{'apikey':SBK,'Authorization':'Bearer '+SBK,'Content-Type':'application/json','Prefer':'return=minimal',...x};}

function initRadar(){
  const s=sessionStorage.getItem('sesami-role');
  if(!s){document.getElementById('rscreen').classList.add('open');}
  else{rrole=s;rApply();if(!window._rl){rLoad();setInterval(rLoad,30000);window._rl=true;}}
}
function rEnter(role){rrole=role;sessionStorage.setItem('sesami-role',role);document.getElementById('rscreen').classList.remove('open');rApply();if(!window._rl){rLoad();setInterval(rLoad,30000);window._rl=true;}}
function rSwitch(){sessionStorage.removeItem('sesami-role');window._rl=false;document.getElementById('rscreen').classList.add('open');}
function rApply(){
  const a=rrole==='admin';
  const b=document.getElementById('r-role-badge');
  b.textContent=a?'üëë Admin':'üëÅÔ∏è Viewer';
  b.className='rrole'+(a?'':' v');
  document.getElementById('radmin-btns').style.display=a?'flex':'none';
}

async function rLoad(){
  rSync('ld','carregando...');
  try{
    const r=await fetch(`${SBU}/rest/v1/${TBL}?select=*&order=updated_at.desc`,{headers:sbH()});
    if(!r.ok)throw new Error();
    const rows=await r.json();
    raccs=rows.map(x=>x.data);
    rRender();rSync('sy',`${raccs.length} contas`);
  }catch{rSync('er','erro ao sincronizar');}
}
async function rSaveAcc(acc){
  try{await fetch(`${SBU}/rest/v1/${TBL}`,{method:'POST',headers:sbH({'Prefer':'resolution=merge-duplicates,return=minimal'}),body:JSON.stringify({id:String(acc.id),data:acc,updated_at:new Date().toISOString()})});}
  catch{}
}
function rSync(cls,msg){const el=document.getElementById('rsync');el.className='rsync '+cls;el.textContent=msg;}

function rGetFilt(){
  return raccs.filter(a=>{
    if(rfilt!=='all'&&a.priority!==rfilt)return false;
    if(rsegf!=='all'&&a.segment!==rsegf)return false;
    if(rsearch&&!a.name.toLowerCase().includes(rsearch.toLowerCase()))return false;
    if(rsigf&&!a.signals.some(s=>s.type===rsigf))return false;
    return true;
  });
}
function rGetSort(list){
  return[...list].sort((a,b)=>{
    if(rsort==='priority'){const o={hot:0,warm:1,cold:2};return o[a.priority]-o[b.priority];}
    if(rsort==='name')return a.name.localeCompare(b.name);
    if(rsort==='signals')return b.signals.length-a.signals.length;
    return 0;
  });
}
function rRender(){
  const grid=document.getElementById('rcards'),empty=document.getElementById('rempty');
  const list=rGetSort(rGetFilt());
  rStats();rCounts();
  if(!list.length){grid.innerHTML='';empty.classList.add('on');return;}
  empty.classList.remove('on');
  const isA=rrole==='admin';
  const si={expansion:'üèóÔ∏è',news:'üì∞',competitor:'‚öîÔ∏è'};
  const bl={hot:'üî¥ Quente',warm:'üü° Morno',cold:'üîµ Frio'};
  grid.innerHTML=list.map((a,i)=>{
    const cl=a.color||COLS[i%COLS.length];
    const init=a.name.split(' ').slice(0,2).map(w=>w[0]).join('').toUpperCase();
    const sigs=a.signals.slice(0,2).map(s=>`<div class="sig ${s.type}"><div class="sigicon">${si[s.type]}</div><div class="sigtext">${s.text}</div><div class="sigtime">${s.time}</div></div>`).join('');
    return`<div class="acard ${a.priority}" style="animation-delay:${i*.04}s">
      <div class="atop">
        <div style="display:flex;align-items:center;gap:9px">
          <div class="aavatar" style="background:${cl[1]};color:${cl[0]}">${init}</div>
          <div><div class="aname">${a.name}</div><div class="aseg">${a.segment||''}${a.stores?' ¬∑ '+Number(a.stores).toLocaleString()+' lojas':''}</div></div>
        </div>
        <div class="abadge b${a.priority[0]}">${bl[a.priority]}</div>
      </div>
      <div class="asigs">${sigs}</div>
      <div id="rp-${a.id}" class="aipanel"></div>
      <div class="afoot">
        <div class="acnt"><span>${a.signals.length}</span> sinal${a.signals.length!==1?'is':''}</div>
        <div class="aacts">
          <button class="raibtn" id="rai-${a.id}" onclick="rAI('${a.id}')">‚ú® Resumo IA</button>
          ${isA?`<button class="rabtn" onclick="rSigModal('${a.id}')">+ Sinal</button>`:''}
        </div>
      </div>
    </div>`;
  }).join('');
}
function rStats(){
  document.getElementById('r-tot').textContent=raccs.length;
  document.getElementById('r-hot').textContent=raccs.filter(a=>a.priority==='hot').length;
  document.getElementById('r-sig').textContent=raccs.reduce((s,a)=>s+a.signals.length,0);
  document.getElementById('r-opp').textContent=raccs.filter(a=>a.priority!=='cold').length;
}
function rCounts(){
  document.getElementById('r-call').textContent=raccs.length;
  document.getElementById('r-chot').textContent=raccs.filter(a=>a.priority==='hot').length;
  document.getElementById('r-cwarm').textContent=raccs.filter(a=>a.priority==='warm').length;
  document.getElementById('r-ccold').textContent=raccs.filter(a=>a.priority==='cold').length;
}
function rSF(f,btn){rfilt=f;rsigf=null;rsegf='all';document.querySelectorAll('.rfbtn').forEach(b=>b.classList.remove('on'));btn.classList.add('on');const l={all:'Todas as Contas',hot:'Contas Quentes',warm:'Contas Mornas',cold:'Contas Frias'};document.getElementById('r-sec-title').textContent=l[f]||'Contas';rRender();}
function rSSig(f,btn){rsigf=rsigf===f?null:f;document.querySelectorAll('.rfbtn').forEach(b=>b.classList.remove('on'));if(rsigf)btn.classList.add('on');rRender();}
function rSSeg(f,btn){rsegf=f;document.querySelectorAll('.rfbtn').forEach(b=>b.classList.remove('on'));btn.classList.add('on');rRender();}
function rFilt(){rsearch=document.getElementById('rsearch').value;rRender();}
function rSortC(v){rsort=v;rRender();}

let rSigFor=null;
function openRM(){if(rrole!=='admin')return;rSigFor=null;document.getElementById('rm-title').textContent='Nova Conta';['rf-name','rf-stores','rf-sigtxt'].forEach(id=>document.getElementById(id).value='');document.getElementById('rm-modal').classList.add('open');}
function rSigModal(id){if(rrole!=='admin')return;rSigFor=id;const a=raccs.find(x=>x.id==id);document.getElementById('rm-title').textContent='+ Sinal ¬∑ '+a.name;document.getElementById('rf-name').value=a.name;document.getElementById('rf-seg').value=a.segment||'';document.getElementById('rf-pri').value=a.priority;document.getElementById('rf-stores').value=a.stores||'';document.getElementById('rf-sigtxt').value='';document.getElementById('rm-modal').classList.add('open');}
function closeRM(){document.getElementById('rm-modal').classList.remove('open');rSigFor=null;}

async function rAddAcc(){
  if(rrole!=='admin')return;
  const name=document.getElementById('rf-name').value.trim();
  if(!name){toast('‚ö†Ô∏è Informe o nome');return;}
  const seg=document.getElementById('rf-seg').value,pri=document.getElementById('rf-pri').value;
  const stores=document.getElementById('rf-stores').value,sigt=document.getElementById('rf-sigtxt').value.trim(),sigty=document.getElementById('rf-sigtyp').value;
  if(rSigFor!==null){
    const acc=raccs.find(x=>x.id==rSigFor);
    acc.priority=pri;
    if(sigt)acc.signals.unshift({type:sigty,text:sigt,time:'agora'});
    await rSaveAcc(acc);toast('‚úÖ Sinal adicionado!');
  }else{
    const acc={id:Date.now(),name,segment:seg,priority:pri,stores:stores||null,color:COLS[raccs.length%COLS.length],signals:sigt?[{type:sigty,text:sigt,time:'agora'}]:[],createdAt:Date.now()};
    raccs.push(acc);await rSaveAcc(acc);toast('‚úÖ Conta adicionada!');
  }
  closeRM();rRender();
}

async function rAI(id){
  const acc=raccs.find(a=>a.id==id);
  const panel=document.getElementById('rp-'+id),btn=document.getElementById('rai-'+id);
  if(panel.classList.contains('on')){panel.classList.remove('on');return;}
  const opM={'Supermercados':'Solu√ß√µes de automa√ß√£o de checkout e gest√£o de estoque s√£o altamente relevantes.','Farm√°cias':'Sistemas de gest√£o, omnichannel e fideliza√ß√£o t√™m alta demanda.','Moda':'Plataformas de e-commerce e experi√™ncia phygital s√£o diferenciais.','Eletr√¥nicos':'Integra√ß√£o de canais e p√≥s-venda digital s√£o eficazes.','Home Center':'Gest√£o de SKUs complexos e marketplace s√£o prioridades.'};
  const aM={hot:'‚ö†Ô∏è Conta QUENTE ‚Äî agende reuni√£o esta semana.',warm:`üìÖ Conta MORNA ‚Äî envie case de sucesso e proponha diagn√≥stico.`,cold:`üìß Conta FRIA ‚Äî mantenha nurturing com conte√∫do relevante.`};
  const si={expansion:'üèóÔ∏è',news:'üì∞',competitor:'‚öîÔ∏è'};
  const momento=acc.signals.length?acc.signals.slice(0,3).map(s=>`‚Ä¢ [${si[s.type]||'üìå'}] ${s.text}`).join('\n'):`‚Ä¢ Nenhum sinal registrado ainda.`;
  const txt=`üéØ MOMENTO (${acc.priority==='hot'?'QUENTE üî•':acc.priority==='warm'?'MORNO ‚ö°':'FRIO üîµ'})\n${momento}\n\nüí° OPORTUNIDADE\n${opM[acc.segment]||'Solu√ß√µes de gest√£o integrada podem gerar valor imediato.'}\n\nüöÄ A√á√ÉO\n${aM[acc.priority]}`;
  panel.innerHTML=`<div class="aipanel-h"><div class="ailbl">‚ú® An√°lise</div><button class="aitext" style="background:none;border:none;color:var(--r-muted);cursor:pointer;font-size:12px" onclick="document.getElementById('rp-${id}').classList.remove('on')">‚úï</button></div><div class="aitext" id="rait-${id}"></div>`;
  panel.classList.add('on');
  const el=document.getElementById('rait-'+id);let i=0;
  const iv=setInterval(()=>{if(i<txt.length){el.textContent+=txt[i];i++;}else clearInterval(iv);},8);
}

async function rAutofill(){toast('‚ÑπÔ∏è Preencha os campos manualmente.');}

function rExcel(){
  const pl={hot:'Quente',warm:'Morno',cold:'Frio'};
  const rows=[['Empresa','Segmento','Prioridade','Lojas','Sinais','Detalhes']];
  raccs.forEach(a=>rows.push([a.name,a.segment||'-',pl[a.priority],a.stores||'-',a.signals.length,a.signals.map(s=>s.text).join(' | ')]));
  const wb=XLSX.utils.book_new(),ws=XLSX.utils.aoa_to_sheet(rows);
  ws['!cols']=[{wch:25},{wch:15},{wch:10},{wch:8},{wch:8},{wch:60}];
  XLSX.utils.book_append_sheet(wb,ws,'Radar');
  XLSX.writeFile(wb,'radar-'+new Date().toLocaleDateString('pt-BR').replace(/\//g,'-')+'.xlsx');
  toast('üìä Excel exportado!');
}

// IMPORT
let riData=[];
function openRI(){if(rrole!=='admin')return;rResetI();document.getElementById('ri-modal').classList.add('open');}
function closeRI(){document.getElementById('ri-modal').classList.remove('open');}
function rDov(e){e.preventDefault();document.getElementById('rdrop').classList.add('over');}
function rDlv(){document.getElementById('rdrop').classList.remove('over');}
function rDdrop(e){e.preventDefault();document.getElementById('rdrop').classList.remove('over');const f=e.dataTransfer.files[0];if(f)rPF(f);}
function rHF(e){const f=e.target.files[0];if(f)rPF(f);}
function rPF(file){
  const rdr=new FileReader(),csv=file.name.endsWith('.csv');
  rdr.onload=function(e){
    let rows=[];
    if(csv)rows=e.target.result.split('\n').map(r=>r.split(/[,;]/).map(c=>c.trim().replace(/^"|"$/g,'')));
    else{const wb=XLSX.read(e.target.result,{type:'binary'});rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]],{header:1,defval:''});}
    rParseI(rows);
  };
  if(csv)rdr.readAsText(file,'UTF-8');else rdr.readAsBinaryString(file);
}
function rParseI(rows){
  if(rows.length<2){toast('‚ö†Ô∏è Arquivo vazio');return;}
  const h=rows[0].map(x=>String(x).toLowerCase().trim());
  const ci={n:h.findIndex(x=>x.includes('nome')||x.includes('empresa')),s:h.findIndex(x=>x.includes('seg')),p:h.findIndex(x=>x.includes('prior')),l:h.findIndex(x=>x.includes('loja')),st:h.findIndex(x=>x.includes('sinal')||x.includes('obs')),ty:h.findIndex(x=>x.includes('tipo'))};
  if(ci.n===-1){toast('‚ö†Ô∏è Coluna "Nome" n√£o encontrada');return;}
  const pm={quente:'hot',hot:'hot',morno:'warm',warm:'warm',frio:'cold',cold:'cold','':'cold'};
  const tm={expans√£o:'expansion',expansao:'expansion',expansion:'expansion',not√≠cia:'news',noticia:'news',news:'news',concorrente:'competitor',competitor:'competitor','':'expansion'};
  const g=(i)=>i>=0?String(rows[0][i]?rows[0][i]:''):'';//dummy
  riData=rows.slice(1).filter(r=>r[ci.n]?.toString().trim()).map(r=>{
    const gv=(i)=>i>=0?String(r[i]||'').trim():'';
    return{name:gv(ci.n),segment:gv(ci.s)||'Outros',priority:pm[gv(ci.p).toLowerCase()]||'cold',stores:gv(ci.l)||null,sigText:gv(ci.st),sigType:tm[gv(ci.ty).toLowerCase()]||'expansion'};
  });
  if(!riData.length){toast('‚ö†Ô∏è Nenhuma conta v√°lida');return;}
  const ex=raccs.map(a=>a.name.toLowerCase());
  const nw=riData.filter(r=>!ex.includes(r.name.toLowerCase()));
  const pl2={hot:'üî¥ Quente',warm:'üü° Morno',cold:'üîµ Frio'};
  document.getElementById('ri-s1').style.display='none';
  document.getElementById('ri-s2').style.display='block';
  document.getElementById('risum').innerHTML=`<div class="ristat"><div class="ristatv">${riData.length}</div><div class="ristatl">No arquivo</div></div><div class="ristat"><div class="ristatv" style="color:var(--r-accent)">${nw.length}</div><div class="ristatl">Novas</div></div><div class="ristat"><div class="ristatv" style="color:var(--warm)">${riData.length-nw.length}</div><div class="ristatl">Duplicadas</div></div>`;
  document.getElementById('rprev').innerHTML=`<thead><tr><th>Empresa</th><th>Segmento</th><th>Prioridade</th></tr></thead><tbody>${riData.slice(0,8).map(r=>`<tr><td>${r.name}</td><td>${r.segment}</td><td>${pl2[r.priority]}</td></tr>`).join('')}${riData.length>8?`<tr><td colspan="3" style="text-align:center;color:var(--r-muted)">... e mais ${riData.length-8}</td></tr>`:''}</tbody>`;
}
async function rConfirmI(){
  const ex=raccs.map(a=>a.name.toLowerCase());let added=0;const na=[];
  riData.forEach(r=>{
    if(ex.includes(r.name.toLowerCase()))return;
    const acc={id:Date.now()+Math.random(),name:r.name,segment:r.segment,priority:r.priority,stores:r.stores||null,color:COLS[raccs.length%COLS.length],signals:r.sigText?[{type:r.sigType,text:r.sigText,time:'importado'}]:[],createdAt:Date.now()};
    raccs.push(acc);na.push(acc);added++;
  });
  closeRI();rRender();toast(`‚úÖ ${added} conta${added!==1?'s':''} importada${added!==1?'s':''}!`);
  await Promise.all(na.map(a=>rSaveAcc(a)));
}
function rResetI(){riData=[];document.getElementById('ri-s1').style.display='block';document.getElementById('ri-s2').style.display='none';document.getElementById('rfile').value='';}
function rDlTpl(){
  const ws=XLSX.utils.aoa_to_sheet([['Nome','Segmento','Prioridade','Lojas','Sinal','Tipo Sinal'],['Grupo Exemplo','Supermercados','quente','120','Inaugurou 5 lojas em SP','expans√£o'],['Farm√°cia Modelo','Farm√°cias','morno','45','','']]);
  ws['!cols']=[{wch:25},{wch:15},{wch:12},{wch:8},{wch:40},{wch:15}];
  const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,'Contas');
  XLSX.writeFile(wb,'modelo-radar.xlsx');toast('‚¨áÔ∏è Modelo baixado!');
}

// ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ
function setOut(boxId,outId,text){
  document.getElementById(boxId).classList.add('got');
  const el=document.getElementById(outId);
  el.classList.remove('outph');
  el.textContent=text;
}
function cp(elId,btnId){
  const t=document.getElementById(elId).textContent;
  if(!t||t.includes('Preencha')||t.includes('Escolha')){toast('‚ö†Ô∏è Gere o conte√∫do primeiro');return;}
  navigator.clipboard.writeText(t).then(()=>{
    const b=document.getElementById(btnId);
    b.textContent='‚úì Copiado!';b.classList.add('ok');
    setTimeout(()=>{b.textContent='Copiar';b.classList.remove('ok');},2000);
    toast('‚úÖ Copiado!');
  });
}
function toast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('on');setTimeout(()=>t.classList.remove('on'),2500);}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
renderP();
</script>
</body>
</html>